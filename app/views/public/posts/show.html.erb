<div class="container mt-5">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h2>投稿詳細</h2>
      <div class="card shadow-sm p-4 mt-3">
        <p class="mt-3" style="white-space: pre-wrap;"><%= @post.body %></p>
        <p class="text-muted text-right">投稿者: <%= @post.user.name %></p>
        
        <div class="mt-4 d-flex border-bottom pb-3"> <% if @post.user == current_user %>
            <%= link_to "編集する", edit_post_path(@post), class: "btn btn-success mr-2" %>
            <%= button_to "削除する", post_path(@post), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger" %>
          <% end %>
          <%= link_to "一覧へ戻る", posts_path, class: "btn btn-outline-secondary ml-2" %>
        </div>

        <div class="comment-area mt-4">
          <h5>コメント一覧 (<%= @post.post_comments.count %>件)</h5>
          
          <% @post.post_comments.each do |post_comment| %>
            <div class="d-flex align-items-start mb-3 border-bottom pb-2">
              <%= image_tag post_comment.user.get_profile_image(40,40), class: "rounded-circle mr-3" %>
              
              <div class="w-100">
                <div class="d-flex justify-content-between">
                  <strong><%= post_comment.user.name %></strong>
                  <small class="text-muted"><%= post_comment.created_at.strftime('%Y/%m/%d %H:%M') %></small>
                </div>
                <div class="mt-1"><%= post_comment.comment %></div>
              
                <% if post_comment.user == current_user %>
                  <div class="text-right">
                    <%= link_to "削除", post_post_comment_path(post_comment.post, post_comment), method: :delete, class: "text-danger small", data: { confirm: "コメントを削除しますか？" } %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>

          <%# コメント投稿フォーム %>
          <div class="mt-4">
            <%= form_with model: [@post, @post_comment], local: true do |f| %>
              <div class="form-group">
                <%= f.text_area :comment, rows: '3', class: "form-control", placeholder: "コメントを入力" %>
              </div>
              <%= f.submit "送信する", class: "btn btn-primary btn-block" %>
            <% end %>
          </div>
        </div>
        </div>
    </div>
  </div>
</div>