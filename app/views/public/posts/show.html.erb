<div class="container mt-5">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h2>投稿詳細</h2>
      <div class="card shadow-sm p-4 my-3">
        <div class="post-image text-center mb-4">
          <% if @post.image.attached? %>
            <%= image_tag @post.image.variant(resize_to_fill: [500, 500]).processed, 
                class: "img-fluid shadow-sm", 
                style: "max-height: 500px; object-fit: contain; cursor: pointer;",
                data: { toggle: "modal", target: "#postImageModal" } %>
            
            <div class="mt-2">
              <small class="text-muted"><i class="fas fa-search-plus"></i> 画像をクリックして拡大</small>
            </div>
          <% else %>
            <div class="bg-light d-flex align-items-center justify-content-center rounded" style="height: 300px;">
              <p class="text-muted">No Image</p>
            </div>
          <% end %>
        </div>
          <p class="mt-3" style="white-space: pre-wrap;"><%= @post.body %></p>
          <% #地図連携 %>
          <% if @post.address.present? %>
            <div class="mt-4 mb-4">
              <div class="p-3 border rounded bg-light shadow-sm">
                <div class="d-flex align-items-center justify-content-between">
                  <div>
                    <i class="fas fa-map-marker-alt text-danger mr-2"></i>
                    <strong>スポット：</strong><%= @post.address %>
                  </div>
                  
                  <% #Googleマップの検索URL %>
                  <%= link_to "https://www.google.com/maps/search/?api=1&query=#{u @post.address}", target: '_blank', class: "btn btn-sm btn-primary" do %>
                    Googleマップで開く <i class="fas fa-external-link-alt ml-1"></i>
                  <% end %>
                </div>
                
                <% if @post.latitude.present? && @post.longitude.present? %>
                  <div class="mt-2 small text-muted">
                    <i class="fas fa-info-circle"></i> GoogleMapで詳細な位置が確認できます
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
          <%= render "public/favorites/btn", post: @post %>
          <p class="text-muted text-left">投稿者: <%= @post.user.name %></p>
          
          <div class="mt-4 d-flex border-bottom pb-3"> <% if @post.user == current_user %>
              <%= link_to "編集する", edit_post_path(@post), class: "btn btn-success mr-2" %>
              <%= button_to "削除する", post_path(@post), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-danger" %>
            <% end %>
            <%= link_to "一覧へ戻る", posts_path, class: "btn btn-outline-secondary ml-2" %>
          </div>
          <% #コメント一覧 %>
          <div class="comment-area mt-4">
            <div id="post_comments_index">
              <%= render "public/post_comments/index", post: @post %>
            </div>

            <% #コメント投稿フォーム %>
            <div class="mt-4">
            <% if user_signed_in? && !current_user.guest_user? %>
              <%= form_with model: [@post, @post_comment], local: false do |f| %>
                <div class="form-group">
                  <%= f.text_area :comment, rows: '3', class: "form-control", placeholder: "コメントを入力" %>
                </div>
                <%= f.submit "送信する", class: "btn btn-primary btn-block" %>
              <% end %>
            <% else %>
              <div class="card bg-light">
                <div class="card-body p-3 text-center">
                  <p class="card-text small text-muted mb-0">
                  <i class="fas fa-exclamation-triangle text-warning mr-2 mt-1"></i>
                      ゲストユーザーはコメントできません。
                  </p>
                </div>
              </div>
            <% end %>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
<div class="modal fade" id="postImageModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content bg-transparent border-0 shadow-none">
      <div class="modal-body p-0 text-center position-relative">
        <button type="button" class="close text-white position-absolute" style="top: -40px; right: 0; font-size: 2.5rem; opacity: 1;" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>

        <% if @post.image.attached? %>
          <%= image_tag @post.image, class: "img-fluid rounded shadow-lg", style: "max-height: 90vh;" %>
        <% end %>
      </div>
    </div>
  </div>
</div>