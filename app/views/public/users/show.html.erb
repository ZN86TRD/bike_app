<div class="container mt-5">
  <div class="row">
    <div class="col-md-4">
      <h2>マイページ</h2>
      <div class="card shadow-sm p-4 text-center mt-3">
        <div class="mb-3">
          <% if @user.profile_image.attached? %>
            <%= image_tag @user.get_profile_image(150, 150), class: "rounded-circle shadow-sm" %>
          <% else %>
            <div class="bg-light d-flex align-items-center justify-content-center rounded-circle mx-auto shadow-sm" style="width: 150px; height: 150px;">
              <i class="fas fa-user fa-5x text-secondary"></i>
            </div>
          <% end %>
        </div>
        <h4 class="font-weight-bold"><%= @user.name %></h4>
        <div class="d-flex justify-content-center small mt-2">
          <div class="mx-2">
            <%= link_to user_followings_path(@user), class: "text-dark" do %>
              <strong><%= @user.followings.count %></strong> フォロー
            <% end %>
          </div>
          <div class="mx-2">
            <%= link_to user_followers_path(@user), class: "text-dark" do %>
              <strong><%= @user.followers.count %></strong> フォロワー
            <% end %>
          </div>
          <div class="mx-2 border-left pl-3">
            <%= link_to favorites_path(@user), class: "text-dark" do %>
              <i class="fas fa-heart text-danger"></i>いいね
            <% end %>
          </div>
        </div>
        <div class="mt-4 text-left">
          <p class="small text-muted mb-1 font-weight-bold">自己紹介</p>
          <div class="p-2 bg-light rounded border small">
            <% if @user.introduction.present? %>
              <%= simple_format(@user.introduction) %>
            <% else %>
              <p class="text-muted mb-0">Hello!</p>
            <% end %>
          </div>
        </div>
        <% if @user == current_user %>
            <% if @user.email != 'guest@example.com' %>
            <div class="mt-3">
              <%= link_to edit_user_path(@user), class: "btn btn-outline-secondary btn-sm btn-block shadow-sm" do %>
                <i class="fas fa-user-edit mr-1"></i> プロフィールを編集
              <% end %>
            </div>
            <% else %>
              <p class="text-muted small mt-3">※ゲストログイン中</p>
            <% end %>
        <% else %>
          <% if user_signed_in? && !current_user.guest_user? && !@user.guest_user? %>
            <div class="mt-3">
              <%= render "public/relationships/btn", user: @user %>
            </div>
          <% elsif @user.guest_user? %>
            <p class="text-muted small mt-3">※ゲストユーザーはフォローできません</p>
          <% end %>
        <% end %>
      </div>
    </div>

    <div class="col-md-8">
      <h3 class="mb-4">投稿一覧</h3>
      <table class="table shadow-sm bg-white">
        <thead class="table-light">
          <tr>
            <th>画像</th>
            <th>タイトル</th>
            <th>本文</th>
          </tr>
        </thead>
        <tbody>
          <% @posts.each do |post| %>
            <tr>
              <td style="width: 100px;">
                <% if post.image.attached? %>
                  <%= image_tag post.image.variant(resize_to_limit: [100, 100]).processed, class: "img-thumbnail" %>
                <% else %>
                  <div class="bg-light text-center py-3 text-muted" style="font-size: 0.8rem;">No Image</div>
                <% end %>
              </td>
              <td class-"fw-bold">
                <%= link_to post.title, post_path(post)%>
                <div class="d-flex">
                    <%= render "public/favorites/btn", post: post %>
                  <span class="small  mt-1 ml-2 text-muted font-weight-normal">
                    <i class="far fa-comment"></i> <%= post.post_comments.count %>
                  </span>
                </div>
              </td>
              <td><%= truncate(post.body, length: 50) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
      <div class="d-flex justify-content-center mt-4">
        <%= paginate @posts %>
      </div>
    </div>
  </div>
</div>
